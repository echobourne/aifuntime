const startCallBtn = document.getElementById("startCallBtn");
const audioPlayer = document.getElementById("audioPlayer");
const vibeSelect = document.getElementById("vibeSelect");

// Map vibe to custom text prompt
const vibePrompts = {
  flirty: "Hey baby, I've been thinking about you all day... tell me your secrets.",
  dominant: "You're mine now. Speak when you're told.",
  cute: "Hi there! Wanna talk about cuddles and snacks?",
  dirty: "I'm dripping with anticipation. You ready?",
};

const voice_id = "EXAVITQu4vr4xnSDxMaL"; // Rachel (default) â€” change later for other vibes

startCallBtn.addEventListener("click", async () => {
  const vibe = vibeSelect.value;
  const prompt = vibePrompts[vibe] || "Let's have some fun.";

  startCallBtn.disabled = true;
  startCallBtn.innerText = "Calling...";

  try {
    const response = await fetch("https://api.elevenlabs.io/v1/text-to-speech/" + voice_id, {
      method: "POST",
      headers: {
        "xi-api-key": "sk_e0d702d20c3f212e30f234e131d621c1acb12a5971cf1f9c",
        "Content-Type": "application/json",
        "Accept": "audio/mpeg",
      },
      body: JSON.stringify({
        text: prompt,
        model_id: "eleven_monolingual_v1",
        voice_settings: {
          stability: 0.5,
          similarity_boost: 0.7,
        },
      }),
    });

    if (!response.ok) throw new Error("API error");

    const audioBlob = await response.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    audioPlayer.src = audioUrl;
    audioPlayer.play();
  } catch (err) {
    console.error("Error:", err);
    alert("Something went wrong with the voice call.");
  }

  startCallBtn.disabled = false;
  startCallBtn.innerText = "Start Call";
});
